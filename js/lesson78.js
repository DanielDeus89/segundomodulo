const lessonTitle = "Lesson 78";
const currentVideoId = "TBPCRAhiKHY";

const timeRanges = [

  { start: 0, end: 130 }, 
  { start: 130, end: 184 }, 
  { start: 184, end: 335 }, 
  { start: 335, end: 396 }, 
  { start: 396, end: 529 }, 
  { start: 529, end: 576 }, 
  { start: 576, end: 804 }, 
  { start: 804, end: 895 }, 
  { start: 895, end: 907 }, 
  { start: 907, end: 927 }, 
  { start: 927, end: 943 }, 
  { start: 943, end: 960 }, 
  { start: 960, end: 974 }, 
  { start: 974, end: 988 }, 
  { start: 988, end: 1001 }, 
  { start: 1001, end: 99999 }, 


];

const lessonCards = [
  
   {
   title: "Practice",
    columns: [
      [ 
      ]
    ]
  },
  {
     title: "Change Into - or +",
    columns: [
      [ 
      ]
    ]
  },
  {
    title: "Practice",
    columns: [
      [ 
      ]
    ]
  },
  {
    title: "Change into interrogative",
    columns: [
      [ 
      ]
    ]
  },
  {
    title: "Practice",
    columns: [
      [
      ]
    ]
  },
  {
    title: "Short Answers",
    columns: [
      [
      ]
    ]
  },
{
  "title": "Questions in Trio",
  "columns": [
    [
      ["When does he / she usually watch television?", ""],
      ["How much was his / her cell phone bill last month?", ""],
      ["How many emails does he / she send every day?", ""],
      ["Does he / she think Japanese is as difficult as German is?", ""],
      ["Does his / her father know how to dance?", ""],
      ["What website does he / she often visit?", ""],
      ["When did he / she last buy dental floss?", ""],
      ["Does anybody in his / her family speak English?", ""],
      ["Does he / she have an iPod?", ""],
      ["Does he / she speak English at work?", ""]
    ]
  ]
},
  {
    title: "Now Answer the Following Questions",
    columns: [
      [ 
      ]
    ]
  },
  {
    title: "Web Talk",
    columns: [
      [ 
        ["Are you logged in?", ""],
        ["Not, not yet.", ""],
      ]
    ]
  },
 {
    title: "Listening - Question 1",
    columns: [
      [
      ["img", "../images/78_1.png"],
      ["a)", "", 4, 17],
      ["b)", "", 4, 17],
      ["c)", "", 4, 17]
      ]
    ]
  }, {
    title: "Listening - Question 2",
    columns: [
      [
      ["img", "../images/78_2.png"],
      ["a)", "", 4, 17],
      ["b)", "", 4, 17],
      ["c)", "", 4, 17]
      ]
    ]
  }, {
    title: "Listening - Question 3",
    columns: [
      [
      ["img", "../images/78_3.png"],
      ["a)", "", 4, 17],
      ["b)", "", 4, 17],
      ["c)", "", 4, 17]
      ]
    ]
  }, {
    title: "Listening - Question 4",
    columns: [
      [
      ["img", "../images/78_4.png"],
      ["a)", "", 4, 17],
      ["b)", "", 4, 17],
      ["c)", "", 4, 17]
      ]
    ]
  }, {
    title: "Listening - Question 5",
    columns: [
      [
      ["img", "../images/78_5.png"],
      ["a)", "", 4, 17],
      ["b)", "", 4, 17],
      ["c)", "", 4, 17]
      ]
    ]
  }, {
    title: "Listening - Question 6",
    columns: [
      [
      ["img", "../images/78_6.png"],
      ["a)", "", 4, 17],
      ["b)", "", 4, 17],
      ["c)", "", 4, 17]
      ]
    ]
  },
{
  "title": "Listen and Answer",
  "type": "listening",
  "segments": [
    { "text": " ", "start": 1001, "end": 1008 },  
    { "text": " ", "start": 1008, "end": 1012 },  
    { "text": " ", "start": 1012, "end": 1015 },  
    { "text": " ", "start": 1015, "end": 1021 },  
    { "text": " ", "start": 1021, "end": 1026 }  
  ]
},
{
  "title": "Reading & Comprehension",
  "text": "As soon as Joe stood up to answer the teacher's question, he knew that moment would certainly be important to his mother's decision about giving him the digital camera or not. Mrs. Coller, his literature teacher, asked him easy questions from the text, on the other hand she didn't allow him much time to answer. Fortunately everything went fine and Joe got a good grade, now he can take pictures and have his album collection each time bigger.",
  "columns": [
    [
      [
        "As soon as Joe stood up to answer the teacher's question, he knew that moment would certainly be important to his mother's decision about giving him the digital camera or not. Mrs. Coller, his literature teacher, asked him easy questions from the text, on the other hand she didn't allow him much time to answer. Fortunately everything went fine and Joe got a good grade, now he can take pictures and have his album collection each time bigger.",
        ""
      ]
    ]
  ]
},
{
  "title": "Reading & Comprehension",
  "text": "I will invite some friends to celebrate Jimmy's birthday with a surprise party. I need to get my phone book to call some friends who live far away. After lunch, I will go for a walk in the neighborhood to meet my brother-in-law in front of the public building, where he works. He will fast let the family know about the party. In the evening, I'll put on my blue dress and wait for my dear husband to arrive.",
  "columns": [
    [
      ["1. She'll meet her brother-in-law in front of", ""],
      ["a) the public library.", ""],
      ["b) the public building.", ""],
      ["c) her house.", ""]
    ]
  ]
},
{
  "title": "Reading & Comprehension",
  "text": "I will invite some friends to celebrate Jimmy's birthday with a surprise party. I need to get my phone book to call some friends who live far away. After lunch, I will go for a walk in the neighborhood to meet my brother-in-law in front of the public building, where he works. He will fast let the family know about the party. In the evening, I'll put on my blue dress and wait for my dear husband to arrive.",
  "columns": [
    [
      ["2. It will be a", ""],
      ["a) public party.", ""],
      ["b) surprise birthday party.", ""],
      ["c) family reunion.", ""]
    ]
  ]
},
{
  "title": "Reading & Comprehension",
  "text": "I will invite some friends to celebrate Jimmy's birthday with a surprise party. I need to get my phone book to call some friends who live far away. After lunch, I will go for a walk in the neighborhood to meet my brother-in-law in front of the public building, where he works. He will fast let the family know about the party. In the evening, I'll put on my blue dress and wait for my dear husband to arrive.",
  "columns": [
    [
      ["3. Who will be invited to the party?", ""],
      ["a) Family and friends.", ""],
      ["b) Co-workers and family.", ""],
      ["c) Friends and co-workers.", ""]
    ]
  ]
},
{
  "title": "Reading & Comprehension",
  "text": "I will invite some friends to celebrate Jimmy's birthday with a surprise party. I need to get my phone book to call some friends who live far away. After lunch, I will go for a walk in the neighborhood to meet my brother-in-law in front of the public building, where he works. He will fast let the family know about the party. In the evening, I'll put on my blue dress and wait for my dear husband to arrive.",
  "columns": [
    [
      ["4. She will invite people", ""],
      ["a) by email and a phone call.", ""],
      ["b) by email and personally.", ""],
      ["c) with a phone call and personally.", ""]
    ]
  ]
},
{
  "title": "Who is Who?",
  "columns": [
    [
      ["Whose birthday is it this month?", ""],
      ["Who takes a walk every morning?", ""],
      ["Who knows how to dance?", ""],
      ["Who went to Disney?", ""],
      ["Who has a passport?", ""],
      ["Who knows how to cook?", ""]
    ]
  ]
}

];

function loadLessonContent() {
  document.getElementById("lessonTitle").textContent = lessonTitle;
  const stack = document.querySelector(".card-stack");
  stack.innerHTML = "";

  lessonCards.forEach((card, index) => {
    const div = document.createElement("div");
    div.className = "card";
    if (index === 0) div.classList.add("active");

    // Verifica se existe imagem no card
if (card.image) {
  const img = document.createElement("img");
  img.src = card.image;
  img.alt = "Imagem da pergunta";
  img.style.maxWidth = "100%";
  img.style.marginBottom = "10px";
  div.appendChild(img);
}


    if (card.title) {
      const h2 = document.createElement("h2");
      h2.className = "section-title";
      h2.textContent = card.title;
      div.appendChild(h2);
    }

    // Cards do tipo Listening
    if (card.type === "listening" && Array.isArray(card.segments)) {
      const row = document.createElement("div");
      row.className = "listening-row";

      card.segments.forEach((segment) => {
        const cardDiv = document.createElement("div");
        cardDiv.className = "listening-card";

        const playBtn = document.createElement("button");
        playBtn.textContent = "â–¶ï¸ Ouvir";
        playBtn.onclick = () => playSegment(segment.start, segment.end);

        const toggleBtn = document.createElement("button");
        toggleBtn.textContent = "ðŸ‘ï¸ Exibir";
        toggleBtn.onclick = function () {
          toggleText(this);
        };

        const span = document.createElement("span");
        span.className = "hidden-text";
        span.textContent = segment.text;

        cardDiv.appendChild(playBtn);
        cardDiv.appendChild(toggleBtn);
        cardDiv.appendChild(span);
        row.appendChild(cardDiv);
      });

      div.appendChild(row);
      stack.appendChild(div);
      return;
    }

    // Outros tipos de cards
    const grid = document.createElement("div");
    grid.className = "grid2";

    card.columns.forEach(colData => {
      const col = document.createElement("div");
      col.className = "vocab-col";

colData.forEach(item => {
  // Verifica se Ã© uma imagem
  if (item[0] === "img" && item[1]) {
    const img = document.createElement("img");
    img.src = item[1];
    img.alt = "Imagem da coluna";
   img.style.display = "block";
img.style.margin = "0 auto 30px";
img.style.maxWidth = "200%";
img.style.maxHeight = "300px";
img.style.borderRadius = "8px";
img.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";

    
    col.appendChild(img);
  } else {
    const p = document.createElement("p");

    if (item.length === 4) {
      const [text, , start, end] = item;

      const span = document.createElement("span");
      span.className = "text-blue clickable";
      span.textContent = text;
      span.onclick = () => playSegment(start, end);

      p.appendChild(span);
    } else {
      const [en, pt] = item;
      p.innerHTML = `<span class="text-blue">${en}</span><br><span class="text-white">${pt}</span>`;
    }

    col.appendChild(p);
  }
});


      grid.appendChild(col);
    });

    div.appendChild(grid);
    stack.appendChild(div);
  });
}


function playSegment(start, end) {
  const iframe = document.querySelector("iframe");
  iframe.contentWindow.postMessage(
    JSON.stringify({
      event: "command",
      func: "loadVideoById",
      args: [{
        videoId: currentVideoId,
        startSeconds: start,
        endSeconds: end
      }]
    }),
    "*"
  );
}

function toggleText(button) {
  const card = button.closest(".listening-card");
  const isNowVisible = card.classList.toggle("show-text");
  button.textContent = isNowVisible ? "ðŸ™ˆ Ocultar" : "ðŸ‘ï¸ Exibir";
}



window.onload = () => {
  loadLessonContent();
};
