const lessonTitle = "Lesson 67";
const currentVideoId = "4ca8KkjWUaU";

const timeRanges = [
  { start: 10, end: 27 }, 
  { start: 27, end: 78 },
  { start: 78, end: 108 }, 
  { start: 108, end: 149 }, 
  { start: 149, end: 187 }, 
  { start: 187, end: 227 }, //https://youtu.be/4ca8KkjWUaU?t=227 https://youtu.be/4ca8KkjWUaU?t=556
  { start: 227, end: 275 }, //https://youtu.be/4ca8KkjWUaU?t=275
  { start: 275, end: 321 }, //https://youtu.be/4ca8KkjWUaU?t=321
  { start: 321, end: 362 }, //https://youtu.be/4ca8KkjWUaU?t=362 https://youtu.be/4ca8KkjWUaU?t=558
  { start: 362, end: 547 }, //https://youtu.be/4ca8KkjWUaU?t=362 https://youtu.be/4ca8KkjWUaU?t=549
  { start: 556, end: 793 }, //https://youtu.be/4ca8KkjWUaU?t=794 https://youtu.be/4ca8KkjWUaU?t=794
  { start: 803, end: 938 }, //https://youtu.be/4ca8KkjWUaU?t=794 https://youtu.be/4ca8KkjWUaU?t=804 https://youtu.be/4ca8KkjWUaU?t=938
  { start: 938, end: 9999 }, //https://youtu.be/4ca8KkjWUaU?t=794 https://youtu.be/4ca8KkjWUaU?t=804 https://youtu.be/4ca8KkjWUaU?t=938



];

const lessonCards = [
 {
    title: "Verbs",
    columns: [
      [["to think, thought", "pensar, achar (que)"]],
      [["to bring, brought", "trazer"]],
      [["to leave, left", "partir, deixar, sair"]]
    ]
  },
{
  "title": "Vocabulary",
  "columns": [
    [
      ["another", "um outro"],
      ["both", "ambos"],
      ["notebook", "caderno"],
      ["message", "mensagem, recado"],
      ["life", "vida"]
    ],
    [
      ["wonderful", "maravilhoso"],
      ["interested", "interessado"],
      ["Switzerland", "Suíça"],
      ["Sweden", "Suécia"],
      ["away", "longe, fora"]
    ],
    [
      ["refrigerator", "geladeira"],
      ["warm", "morno"],
      ["frozen", "congelado"],
      ["laptop", "laptop"],
      ["printer", "impressora"]
    ]
  ]
},

  {
  "title": "Expressions",
  "columns": [
    [
      ["I think so", "Eu acho que sim"],
      ["I don't think so", "Eu acho que não"]
    ],
       [
      ["everybody", "todos, todo mundo"],
      ["to go away", "ir embora"]
    ],
    [
      ["desktop computer", "computador pessoal"],
      ["contact list", "lista de contatos"]
    ]   ,
     [

      ["suddenly", "de repente"]
    ]
  ]
},
  {
  "title": "Grammar",
  "columns": [
    [
      ["I'm thinking about going to Miami.", "Estou pensando em ir para Miami."],
      ["Are they thinking of coming to China?", "Eles estão pensando em vir à China?"],
      ["She was interested in buying a new printer.", "Ela estava interessada em comprar uma nova impressora."],
      ["Where were you going last night?", "Onde você estava indo na noite passada?"],
      ["What was she doing in Sweden?", "O que ela estava fazendo na Suécia?"],
      ["Why were they coming here?", "Por que eles estavam vindo aqui?"]
    ]
  ]
},
  {
  "title": "Grammar",
  "columns": [
    [
      ["We were", ""],
      ["You were", ""],
      ["They were", ""]
    ],
    [
      ["We weren't", ""],
      ["You weren't", ""],
      ["They weren't", ""]
    ],
        [
      ["Were we?", ""],
      ["Were you?", ""],
      ["Were they?", ""]
    ],
    [
      ["Weren't we?", ""],
      ["Weren't you?", ""],
      ["Weren't they?", ""]
    ]
  ]
},
{
  "title": "Phrases",
  "columns": [
    [
      ["I think it's a good idea.", ""],
      ["We thought about it.", ""],
      ["Did you think about it?", ""],
      ["We'll think about it.", ""]
    ],
    [
      ["Is it time to leave?", ""],
      ["They left an hour ago.", ""],
      ["Can we leave early today?", ""],
      ["He left his house at 6:30.", ""]
    ]
  ]
},
{
  "title": "Phrases",
  "columns": [
    [
      ["Did they bring anybody with them?", ""],
      ["Does he always bring you flowers?", ""],
      ["We brought this laptop for you.", ""],
      ["She didn't bring a warm coat.", ""]
    ],
    [
      ["Everybody loves her.", ""],
      ["Are you going away?", ""],
      ["He suddenly left.", ""],
      ["Don't you have his email?", ""]
    ]
  ]
},

{
  "title": "Phrases",
  "columns": [
    [
      ["Are they thinking about traveling?", ""],
      ["I'm thinking about leaving.", ""],
      ["Were you doing your homework?", ""],
      ["They aren't thinking of coming here.", ""]
    ],
    [
      ["Weren't they interested in doing it?", ""],
      ["They were going there.", ""],
      ["We were singing at church.", ""],
      ["Weren't they cleaning it?", ""]
    ]
  ]
},
{
  "title": "Phrases",
  "columns": [
    [
      ["We were hungry.", ""],
      ["Were you late?", ""],
      ["Were they tired?", ""],
      ["Weren't you sick?", ""]
    ],
    [
      ["We weren't ready.", ""],
      ["They weren't upset.", ""],
      ["Were you at work?", ""],
      ["Were they in a hurry?", ""]
    ]
  ]
},
 {
    title: "Verbs",
    columns: [
      [["to think, thought", "pensar, achar (que)"]],
      [["to bring, brought", "trazer"]],
      [["to leave, left", "partir, deixar, sair"]]
    ]
  },
  {
  "title": "Vocabulary",
  "columns": [
    [
      ["another", "um outro"],
      ["both", "ambos"],
      ["notebook", "caderno"],
      ["message", "mensagem, recado"],
      ["life", "vida"],
      ["wonderful", "maravilhoso"],
      ["interested", "interessado"],
      ["Switzerland", "Suíça"]
    ],
    [
      ["Sweden", "Suécia"],
      ["away", "longe, fora"],
      ["refrigerator", "geladeira"],
      ["warm", "morno"],
      ["frozen", "congelado"],
      ["laptop", "laptop"],
      ["printer", "impressora"]
    ]
  ]
},
  {
  "title": "Expressions",
  "columns": [
    [
      ["I think so", "Eu acho que sim"],
      ["I don't think so", "Eu acho que não"]
    ],
       [
      ["everybody", "todos, todo mundo"],
      ["to go away", "ir embora"]
    ],
    [
      ["desktop computer", "computador pessoal"],
      ["contact list", "lista de contatos"]
    ]   ,
     [

      ["suddenly", "de repente"]
    ]
  ]
},



{
  "title": "Grammar",
  "columns": [
    [
      ["I'm thinking about going to Miami.", "Estou pensando em ir para Miami."],
      ["Are they thinking of coming to China?", "Eles estão pensando em vir à China?"],
      ["She was interested in buying a new printer.", "Ela estava interessada em comprar uma nova impressora."],
      ["Where were you going last night?", "Onde você estava indo na noite passada?"],
      ["What was she doing in Sweden?", "O que ela estava fazendo na Suécia?"],
      ["Why were they coming here?", "Por que eles estavam vindo aqui?"],
      ["",""],      
       [ ["We were", "We weren't", "Were we?", "Weren't we?"],""],
       [ ["You were", "You weren't", "Were you?", "Weren't you?"], ""],
       [ ["You were", "They weren't", "Were they?","Weren't they?"], ""]
    ],    
  ]
}

  

];

function loadLessonContent() {
  document.getElementById("lessonTitle").textContent = lessonTitle;
  const stack = document.querySelector(".card-stack");
  stack.innerHTML = "";

  lessonCards.forEach((card, index) => {
    const div = document.createElement("div");
    div.className = "card";
    if (index === 0) div.classList.add("active");

    // Verifica se existe imagem no card
if (card.image) {
  const img = document.createElement("img");
  img.src = card.image;
  img.alt = "Imagem da pergunta";
  img.style.maxWidth = "100%";
  img.style.marginBottom = "10px";
  div.appendChild(img);
}


    if (card.title) {
      const h2 = document.createElement("h2");
      h2.className = "section-title";
      h2.textContent = card.title;
      div.appendChild(h2);
    }

    // Cards do tipo Listening
    if (card.type === "listening" && Array.isArray(card.segments)) {
      const row = document.createElement("div");
      row.className = "listening-row";

      card.segments.forEach((segment) => {
        const cardDiv = document.createElement("div");
        cardDiv.className = "listening-card";

        const playBtn = document.createElement("button");
        playBtn.textContent = "▶️ Ouvir";
        playBtn.onclick = () => playSegment(segment.start, segment.end);

        const toggleBtn = document.createElement("button");
        toggleBtn.textContent = "👁️ Exibir";
        toggleBtn.onclick = function () {
          toggleText(this);
        };

        const span = document.createElement("span");
        span.className = "hidden-text";
        span.textContent = segment.text;

        cardDiv.appendChild(playBtn);
        cardDiv.appendChild(toggleBtn);
        cardDiv.appendChild(span);
        row.appendChild(cardDiv);
      });

      div.appendChild(row);
      stack.appendChild(div);
      return;
    }

    // Outros tipos de cards
    const grid = document.createElement("div");
    grid.className = "grid2";

    card.columns.forEach(colData => {
      const col = document.createElement("div");
      col.className = "vocab-col";

colData.forEach(item => {
  // Verifica se é uma imagem
  if (item[0] === "img" && item[1]) {
    const img = document.createElement("img");
    img.src = item[1];
    img.alt = "Imagem da coluna";
   img.style.display = "block";
img.style.margin = "0 auto 30px";
img.style.maxWidth = "200%";
img.style.maxHeight = "300px";
img.style.borderRadius = "8px";
img.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";

    
    col.appendChild(img);
  } else {
    const p = document.createElement("p");

    if (item.length === 4) {
      const [text, , start, end] = item;

      const span = document.createElement("span");
      span.className = "text-blue clickable";
      span.textContent = text;
      span.onclick = () => playSegment(start, end);

      p.appendChild(span);
    } else {
      const [en, pt] = item;
      p.innerHTML = `<span class="text-blue">${en}</span><br><span class="text-white">${pt}</span>`;
    }

    col.appendChild(p);
  }
});


      grid.appendChild(col);
    });

    div.appendChild(grid);
    stack.appendChild(div);
  });
}


function playSegment(start, end) {
  const iframe = document.querySelector("iframe");
  iframe.contentWindow.postMessage(
    JSON.stringify({
      event: "command",
      func: "loadVideoById",
      args: [{
        videoId: currentVideoId,
        startSeconds: start,
        endSeconds: end
      }]
    }),
    "*"
  );
}

function toggleText(button) {
  const card = button.closest(".listening-card");
  const isNowVisible = card.classList.toggle("show-text");
  button.textContent = isNowVisible ? "🙈 Ocultar" : "👁️ Exibir";
}



window.onload = () => {
  loadLessonContent();
};
