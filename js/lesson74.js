const lessonTitle = "Lesson 74";
const currentVideoId = "TmwHusKG7Y4";

const timeRanges = [
  { start: 7, end: 135 }, //https://youtu.be/TmwHusKG7Y4?t=135
  { start: 135, end: 193 }, //https://youtu.be/TmwHusKG7Y4?t=193
  { start: 193, end: 341 }, //https://youtu.be/TmwHusKG7Y4?t=341
  { start: 341, end: 407 }, //https://youtu.be/TmwHusKG7Y4?t=407
  { start: 407, end: 545 }, //https://youtu.be/TmwHusKG7Y4?t=545
  { start: 545, end: 597 }, //https://youtu.be/TmwHusKG7Y4?t=597
  { start: 609, end: 778 }, //https://youtu.be/TmwHusKG7Y4?t=778
  { start: 788, end: 869 }, //https://youtu.be/TmwHusKG7Y4?t=816
  { start: 878, end: 888 }, //https://youtu.be/TmwHusKG7Y4?t=888
  { start: 962, end: 1023 }, //https://youtu.be/TmwHusKG7Y4?t=1023
  { start: 1035, end: 1074 }, //https://youtu.be/TmwHusKG7Y4?t=1074
  { start: 1074, end: 1089 }, // 
  { start: 1089, end: 1100 }, // 
  { start: 1100, end: 1113 }, //https://youtu.be/TmwHusKG7Y4?t=1113
  { start: 1114, end: 1120 }, //https://youtu.be/TmwHusKG7Y4?t=1120
  { start: 1120, end: 1133 }, //https://youtu.be/TmwHusKG7Y4?t=1133
  { start: 1133, end: 1145 }, //https://youtu.be/TmwHusKG7Y4?t=1145
  { start: 1152, end: 1174 }, //https://youtu.be/TmwHusKG7Y4?t=1145
  { start: 1174, end: 1175 }, //https://youtu.be/TmwHusKG7Y4?t=1145
 
 
];

const lessonCards = [

   
  {
   title: "Practice",
    columns: [
      [ 
      ]
    ]
  },
  {
     title: "Change Into - or +",
    columns: [
      [ 
      ]
    ]
  },
  {
    title: "Practice",
    columns: [
      [ 
      ]
    ]
  },
  {
    title: "Change into interrogative",
    columns: [
      [ 
      ]
    ]
  },
  {
    title: "Practice",
    columns: [
      [
      ]
    ]
  },
  {
    title: "Short Answers",
    columns: [
      [
      ]
    ]
  },
 {
  "title": "Questions in Trio",
  "columns": [
    [
      ["What computer does he/she have.", ""],
      ["Does he/she have an iPhone.", ""],
      ["When is his/her birthday.", ""],
      ["Will he/she travel to another country this year.", ""],
      ["What's his/her email.", ""],
      ["Does he/she usually go for a walk.", ""],
      ["How often does he/she use his/her cell phone.", ""],
      ["Does he/she have a new passport.", ""],
      ["Does he/she have a credit card.", ""],
      ["Can he/she remember his/her first teacher's name.", ""]
    ]
  ]
},
  {
    title: "Now Answer the Following Questions",
    columns: [
      [ 
      ]
    ]
  },
 {
    title: "Web Talk",
    columns: [
      [ 
      ]
    ]
  },
{
  "title": "Speak Right - Pronunciation",
  "columns": [
    [
      ["it", "isso / ele / ela (para coisas)"],
      ["is", "Ã© / estÃ¡"],
      ["in", "em / dentro"],
      ["pin", "alfinete / prender com alfinete"],
      ["lip", "lÃ¡bio"],
      ["kid", "crianÃ§a / garoto"],
      ["sick", "doente"],
      ["tip", "dica / gorjeta / ponta"],
      ["fix", "consertar / corrigir"],
      ["mix", "misturar"]
    ],
    [
      ["list", "lista"],
      ["fit", "em forma / caber / ajustar"],
      ["kiss", "beijo / beijar"],
      ["miss", "sentir falta / errar / senhorita"],
      ["wish", "desejar / desejo"],
      ["fish", "peixe / pescar"],
      ["trick", "truque / enganar"],
      ["trip", "viagem / tropeÃ§ar"],
      ["thin", "magro / fino"],
      ["did", "fez (passado de do)"]
    ]
  ]
},
{
  "title": "Dialogue & Role Play - Making Plans",
  "columns": [
    [
     ["Ryan: Hi Jake, what are you going to do tonight?", "", 1035, 1038], //https://youtu.be/TmwHusKG7Y4?t=1038
    ["Jake: Hi Ryan, I think I'm going to watch a movie tonight.", "", 1038, 1041], //https://youtu.be/TmwHusKG7Y4?t=1041
    ["Ryan: Really? Which movie are you going to watch?", "", 1041, 1044], //https://youtu.be/TmwHusKG7Y4?t=1049
    ["Jake: An adventure movie. How about you? What are you doing tonight?", "", 1044, 1048], //https://youtu.be/TmwHusKG7Y4?t=1048
    ["Ryan: I'm going to Eric's house. He's going to study in Italy for a year, so I'd like to go to his house and say goodbye.", "", 1048, 1055],
    ["Jake: Who is going to be there?", "", 1055, 1057],
    ["Ryan: I think his family and close friends are going to be there.", "", 1057, 1060],
    ["Jake: Oh nice, I'm sure he's going to miss his family and friends.", "", 1060, 1064],
    ["Ryan: Yeah, but this experience is going to be great for his career.", "", 1063, 1067],
    ["Jake: Well, I have to go now. See you soon.", "", 1067, 1071],
    ["Ryan: See you and have fun with your movie.", "", 1070, 1073]
    ]
  ]
},
{
  "title": "Listening - Question 1",
  "columns": [
    [
      ["a) She needs to be downtown after noon.", ""],
      ["b) She needs to be downtown before noon.", ""],
      ["c) She doesn't need to go downtown today.", ""]
    ]
  ]
},
{
  "title": "Listening - Question 2",
  "columns": [
    [
      ["a) She prefers her soup cold.", ""],
      ["b) She prefers her soup very hot.", ""],
      ["c) She prefers her soup warm.", ""]
    ]
  ]
},
{
  "title": "Listening - Question 3",
  "columns": [
    [
      ["a) They sing at the park.", ""],
      ["b) They sing near the church.", ""],
      ["c) They sing at the church downtown.", ""]
    ]
  ]
},
{
  "title": "Listening - Question 4",
  "columns": [
    [
      ["a) The books were left at home.", ""],
      ["b) The glasses were left at home.", ""],
      ["c) The laptop was left at home.", ""]
    ]
  ]
},
{
  "title": "Listening - Question 5",
  "columns": [
    [
      ["a) They can talk after lunch.", ""],
      ["b) They can talk tomorrow.", ""],
      ["c) They can talk now.", ""]
    ]
  ]
},
{
  "title": "Listening - Question 6",
  "columns": [
    [
      ["a) He is selling his house.", ""],
      ["b) He is selling his car.", ""],
      ["c) He is selling his apartment.", ""]
    ]
  ]
},
{
  "title": "Listen and Write",
  "type": "listening",
  "segments": [
    { "text": "1. Sooner or later heâ€™ll call you.", "start": 1152, "end": 1154 },
    { "text": "2. My son had a bad fever all night long last night.", "start": 1154, "end": 1159 },
    { "text": "3. They invited many people to the party.", "start": 1159, "end": 1163 },
    { "text": "4. I donâ€™t know what the matter is with her today.", "start": 1163, "end": 1168 },
    { "text": "5. We would like to go for a walk at the park now.", "start": 1168, "end": 1174 }
  ]
}



];

function loadLessonContent() {
  document.getElementById("lessonTitle").textContent = lessonTitle;
  const stack = document.querySelector(".card-stack");
  stack.innerHTML = "";

  lessonCards.forEach((card, index) => {
    const div = document.createElement("div");
    div.className = "card";
    if (index === 0) div.classList.add("active");

    // Verifica se existe imagem no card
if (card.image) {
  const img = document.createElement("img");
  img.src = card.image;
  img.alt = "Imagem da pergunta";
  img.style.maxWidth = "100%";
  img.style.marginBottom = "10px";
  div.appendChild(img);
}


    if (card.title) {
      const h2 = document.createElement("h2");
      h2.className = "section-title";
      h2.textContent = card.title;
      div.appendChild(h2);
    }

    // Cards do tipo Listening
    if (card.type === "listening" && Array.isArray(card.segments)) {
      const row = document.createElement("div");
      row.className = "listening-row";

      card.segments.forEach((segment) => {
        const cardDiv = document.createElement("div");
        cardDiv.className = "listening-card";

        const playBtn = document.createElement("button");
        playBtn.textContent = "â–¶ï¸ Ouvir";
        playBtn.onclick = () => playSegment(segment.start, segment.end);

        const toggleBtn = document.createElement("button");
        toggleBtn.textContent = "ðŸ‘ï¸ Exibir";
        toggleBtn.onclick = function () {
          toggleText(this);
        };

        const span = document.createElement("span");
        span.className = "hidden-text";
        span.textContent = segment.text;

        cardDiv.appendChild(playBtn);
        cardDiv.appendChild(toggleBtn);
        cardDiv.appendChild(span);
        row.appendChild(cardDiv);
      });

      div.appendChild(row);
      stack.appendChild(div);
      return;
    }

    // Outros tipos de cards
    const grid = document.createElement("div");
    grid.className = "grid2";

    card.columns.forEach(colData => {
      const col = document.createElement("div");
      col.className = "vocab-col";

colData.forEach(item => {
  // Verifica se Ã© uma imagem
  if (item[0] === "img" && item[1]) {
    const img = document.createElement("img");
    img.src = item[1];
    img.alt = "Imagem da coluna";
   img.style.display = "block";
img.style.margin = "0 auto 30px";
img.style.maxWidth = "200%";
img.style.maxHeight = "300px";
img.style.borderRadius = "8px";
img.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";

    
    col.appendChild(img);
  } else {
    const p = document.createElement("p");

    if (item.length === 4) {
      const [text, , start, end] = item;

      const span = document.createElement("span");
      span.className = "text-blue clickable";
      span.textContent = text;
      span.onclick = () => playSegment(start, end);

      p.appendChild(span);
    } else {
      const [en, pt] = item;
      p.innerHTML = `<span class="text-blue">${en}</span><br><span class="text-white">${pt}</span>`;
    }

    col.appendChild(p);
  }
});


      grid.appendChild(col);
    });

    div.appendChild(grid);
    stack.appendChild(div);
  });
}


function playSegment(start, end) {
  const iframe = document.querySelector("iframe");
  iframe.contentWindow.postMessage(
    JSON.stringify({
      event: "command",
      func: "loadVideoById",
      args: [{
        videoId: currentVideoId,
        startSeconds: start,
        endSeconds: end
      }]
    }),
    "*"
  );
}

function toggleText(button) {
  const card = button.closest(".listening-card");
  const isNowVisible = card.classList.toggle("show-text");
  button.textContent = isNowVisible ? "ðŸ™ˆ Ocultar" : "ðŸ‘ï¸ Exibir";
}



window.onload = () => {
  loadLessonContent();
};
