const lessonTitle = "Lesson 84";
const currentVideoId = "3x0tDpkLEaI";

const timeRanges = [

  { start: 0, end: 33 }, 
  { start: 33, end: 65 }, 
  { start: 65, end: 98 }, 
  { start: 98, end: 134 }, 
  { start: 134, end: 167 }, 
  { start: 167, end: 200 }, 
  { start: 200, end: 328 }, 
  { start: 328, end: 382 }, 
  { start: 382, end: 522 }, 
  { start: 522, end: 575 }, 
  { start: 575, end: 703 }, 
  { start: 703, end: 753 }, 
  { start: 753, end: 858 }, 
  { start: 868, end: 988 }, 
  { start: 1009, end: 1024 }, //10
  { start: 1024, end: 1037 }, //11
  { start: 1037, end: 1050 }, //12
  { start: 1050, end: 1112 }, //13
  { start: 1112, end: 1112 }, //13
  { start: 1112, end: 1138 }, //14
  { start: 1153, end: 1245 }, //15
  { start: 1245, end: 99999 }, //16
  { start: 1245, end: 99999 }, //16
 


];

const lessonCards = [
{
  "title": "Conversation in Trio",
  "columns": [
    [
      ["Is this passport his?", ""],
      ["Is this passport yours?", ""],
      ["No, it's not. This passport isn't mine.", ""],
      ["No, it's not. This passport isn't his.", ""]
    ]
  ]
},
{
  "title": "Conversation in Trio",
  "columns": [
    [
      ["Does she know whose DVD this is?", ""],
      ["Do you know whose DVD this is?", ""],
      ["Yes, I do. This DVD is mine.", ""],
      ["Yes, she does. This DVD is hers.", ""]
    ]
  ]
},
{
  "title": "Conversation in Trio",
  "columns": [
    [
      ["Does he know what places I should visit?", ""],
      ["Do you know what places he should visit?", ""],
      ["I think he should visit the Capitol Building.", ""],
      ["He thinks you should visit the Capitol Building.", ""]
    ]
  ]
},
  {
  "title": "Conversation in Trio",
  "columns": [
    [
    ]
  ]
  }, 
  {
  "title": "Conversation in Trio",
  "columns": [
    [
    ]
  ]
  }, 
  {
  "title": "Conversation in Trio",
  "columns": [
    [
    ]
  ]
  }, 
  {
   title: "Practice",
    columns: [
      [ 
      ]
    ]
  },
  {
     title: "Change Into - or +",
    columns: [
      [ 
      ]
    ]
  },
  {
    title: "Practice",
    columns: [
      [ 
      ]
    ]
  },
  {
    title: "Change into interrogative",
    columns: [
      [ 
      ]
    ]
  },
  {
    title: "Practice",
    columns: [
      [
      ]
    ]
  },
  {
    title: "Short Answers",
    columns: [
      [
      ]
    ]
  },
 {
  "title": "Ask your Friend",
  "columns": [
    [
      ["How often he / she works overtime.", ""],
      ["If he / she has a passport.", ""],
      ["What he / she should do to help poor people.", ""],
      ["If he / she should send his / her rÃ©sumÃ© to other companies.", ""],
      ["Why he / she thinks people should learn a second language.", ""],
      ["At what age people should start learning a second language.", ""],
      ["What people should do to get a driver's license.", ""],
      ["How often people should exercise.", ""],
      ["If he / she thinks everybody in class should speak only in English.", ""],
      ["If he / she could name the last 5 presidents of our country.", ""]
    ]
  ]
},
  {
    title: "Ask your Friend",
    columns: [
      [ 
      ]
    ]
  },
   {
  "title": "Conversation in Trio",
  "columns": [
    [
    ]
  ]
  },
   {
  "title": "Conversation in Trio",
  "columns": [
    [
    ]
  ]
  },
   {
  "title": "Conversation in Trio",
  "columns": [
    [
    ]
  ]
  },
{
  "title": "Culture - Driving in the States",
  "columns": [
    [
      ["In the United States, your driver's license is the most important form of identification.", "", 1055, 1062], // introduction
      ["",""],
      ["You can get your first driver's license when you are only 16 years old.", "", 1062, 1067], // age requirement
            ["",""],
      ["Before taking the driver's test, you need to pass a written test and an eye examination.", "", 1067, 1074], // written test and eye exam
            ["",""],
      ["After passing both exams, you will receive a permit that allows you to practice driving with another person who already has a license.", "", 1074, 1084], // learner's permit
            ["",""],
      ["When you are ready to take the driving test, an instructor from the Department of Motor Vehicles has to ride with you and determine if you are following all the traffic regulations.", "", 1084, 1095], // DMV instructor
            ["",""],
      ["If you pass the driving test, you receive a temporary license that allows you to drive until your official license arrives in the mail, usually within 90 days.", "", 1095, 1107], // temporary license
            ["",""],
      ["Traffic laws and regulations may vary from state to state.", "", 1107, 1112] // final note
    ]
  ]
},
{
  "title": "Glossary",
  "columns": [
    [
      ["to pass", "passar"],
      ["to ride", "andar de (carro)"],
      ["to allow", "permitir"],
      ["to vary", "variar"],
      ["identification", "identificaÃ§Ã£o"],
      ["driver's license", "carteira de motorista"]
    ],
    [
      ["driving test", "teste de direÃ§Ã£o"],
      ["written test", "teste escrito"],
      ["eye examination", "exame de vista"],
      ["permit", "permissÃ£o"],
      ["instructor", "instrutor"],
      ["traffic laws", "leis de trÃ¢nsito"]
    ]
  ]
},
{
  "title": "Discussion - ID and Driver's License",
  "type": "listening",
  "segments": [
    { "text": "1. What's the most important form of I.D. in the United States?", "start": 1114, "end": 1119 }, // https://youtu.be/Vhwc65-vfoU?t=1051
    { "text": "2. When can a person get a driver's license in the United States?", "start": 1119, "end": 1125 }, // https://youtu.be/Vhwc65-vfoU?t=1056
    { "text": "3. What's the procedure to get a driver's license in the States?", "start": 1125, "end": 1130 }, // https://youtu.be/3x0tDpkLEaI?t=1130
    { "text": "4. And how does it work in your country?", "start": 1130, "end": 1134 }, // https://youtu.be/Vhwc65-vfoU?t=1063
    { "text": "5. When did you learn how to drive?", "start": 1134, "end": 1138 } // https://youtu.be/Vhwc65-vfoU?t=1067
  ]
},
{
  title: "Listening & Comprehension - See the Big Picture",
  type: "fill-in-the-blanks",
  columns: [
    [
      ["Three men were doing the same __________ of job and __________ asked:", "", 1161, 1166],
      ["\"What kind of __________?\" The first man answered: \"I am laying bricks, one after another.\"", "", 1166, 1174],
      ["The second man answered: \"I am building a wall.\"", "", 1174, 1178],
      ["The third man answered: \"I am building a cathedral that will last __________ centuries.\"", "", 1178, 1186],
      ["As you see, the work the three __________ was the same.", "", 1186, 1191],
      ["But each __________ a different vision, understanding, and attitude regarding his work.", "", 1191, 1198],
      ["Your life is very similar to this story. You hear the alarm clock. You __________.", "", 1198, 1206],
      ["You take a shower. You brush your teeth. You comb your hair. __________.", "", 1206, 1212],
      ["You go to work. __________ back home, answer your emails, watch some TV, __________ and start all over again.", "", 1212, 1221],
      ["Try to see the big picture __________ everything you do.", "", 1221, 1225],
      ["If you can see a purpose in your daily activities, your __________ more pleasant.", "", 1225, 1231],
      ["Have a positive attitude toward your __________ around you.", "", 1231, 1238],
      ["This will affect others and most importantly, it will affect you.", "", 1238, 1245]
    ]
  ]
},
{
  title: "Listening & Comprehension",
  type: "listening",
  segments: [
    { text: "1. What was the first man in the story asked?", start: 1246, end: 1250 }, //https://youtu.be/yeAbAUL7BWs?t=217
    { text: "2. What did the first man in the story answer?", start: 1250, end: 1255 }, //https://youtu.be/yeAbAUL7BWs?t=222
    { text: "3. What did the second man in the story answer?", start: 1255, end: 1259 }, //https://youtu.be/yeAbAUL7BWs?t=229
    { text: "4. What did the third man in the story answer?", start: 1259, end: 1263 }, // https://youtu.be/yeAbAUL7BWs?t=237
    { text: "5. What will happen if you always see the big picture in your life?", start: 1263, end: 1269 } //https://youtu.be/yeAbAUL7BWs?t=241 
  ]
},


];

function loadLessonContent() {
  document.getElementById("lessonTitle").textContent = lessonTitle;
  const stack = document.querySelector(".card-stack");
  stack.innerHTML = "";

  lessonCards.forEach((card, index) => {
    const div = document.createElement("div");
    div.className = "card";
    if (index === 0) div.classList.add("active");

    // Verifica se existe imagem no card
if (card.image) {
  const img = document.createElement("img");
  img.src = card.image;
  img.alt = "Imagem da pergunta";
  img.style.maxWidth = "100%";
  img.style.marginBottom = "10px";
  div.appendChild(img);
}


    if (card.title) {
      const h2 = document.createElement("h2");
      h2.className = "section-title";
      h2.textContent = card.title;
      div.appendChild(h2);
    }

    // Cards do tipo Listening
    if (card.type === "listening" && Array.isArray(card.segments)) {
      const row = document.createElement("div");
      row.className = "listening-row";

      card.segments.forEach((segment) => {
        const cardDiv = document.createElement("div");
        cardDiv.className = "listening-card";

        const playBtn = document.createElement("button");
        playBtn.textContent = "â–¶ï¸ Ouvir";
        playBtn.onclick = () => playSegment(segment.start, segment.end);

        const toggleBtn = document.createElement("button");
        toggleBtn.textContent = "ðŸ‘ï¸ Exibir";
        toggleBtn.onclick = function () {
          toggleText(this);
        };

        const span = document.createElement("span");
        span.className = "hidden-text";
        span.textContent = segment.text;

        cardDiv.appendChild(playBtn);
        cardDiv.appendChild(toggleBtn);
        cardDiv.appendChild(span);
        row.appendChild(cardDiv);
      });

      div.appendChild(row);
      stack.appendChild(div);
      return;
    }

    // Outros tipos de cards
    const grid = document.createElement("div");
    grid.className = "grid2";

    card.columns.forEach(colData => {
      const col = document.createElement("div");
      col.className = "vocab-col";

colData.forEach(item => {
  // Verifica se Ã© uma imagem
  if (item[0] === "img" && item[1]) {
    const img = document.createElement("img");
    img.src = item[1];
    img.alt = "Imagem da coluna";
   img.style.display = "block";
img.style.margin = "0 auto 30px";
img.style.maxWidth = "200%";
img.style.maxHeight = "300px";
img.style.borderRadius = "8px";
img.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";

    
    col.appendChild(img);
  } else {
    const p = document.createElement("p");

    if (item.length === 4) {
      const [text, , start, end] = item;

      const span = document.createElement("span");
      span.className = "text-blue clickable";
      span.textContent = text;
      span.onclick = () => playSegment(start, end);

      p.appendChild(span);
    } else {
      const [en, pt] = item;
      p.innerHTML = `<span class="text-blue">${en}</span><br><span class="text-white">${pt}</span>`;
    }

    col.appendChild(p);
  }
});


      grid.appendChild(col);
    });

    div.appendChild(grid);
    stack.appendChild(div);
  });
}


function playSegment(start, end) {
  const iframe = document.querySelector("iframe");
  iframe.contentWindow.postMessage(
    JSON.stringify({
      event: "command",
      func: "loadVideoById",
      args: [{
        videoId: currentVideoId,
        startSeconds: start,
        endSeconds: end
      }]
    }),
    "*"
  );
}

function toggleText(button) {
  const card = button.closest(".listening-card");
  const isNowVisible = card.classList.toggle("show-text");
  button.textContent = isNowVisible ? "ðŸ™ˆ Ocultar" : "ðŸ‘ï¸ Exibir";
}



window.onload = () => {
  loadLessonContent();
};
